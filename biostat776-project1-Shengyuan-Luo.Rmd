---
title: "biostat776-project1-Shengyuan-Luo"
author: "davidluoshy"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Project 1 - setup

Here I load packages "here", "tidyverse", and "tidytuesday"

```{r}
library("here")
library("tidyverse")
install.packages("pak")
pak::pak("dslc-io/tidytuesdayR")
```

Next I create a directory named "data." The if statement helps avoid re-creating the directory if it already exists.

```{r}
if (!dir.exists(here("data"))) {
    dir.create(here("data"))
}
```

I use the following code to download the dataset. Again, the if statement checks if the dataset already exists. If so, data will not be re-downloaded.

```{r}
if (!file.exists(here("data", "chocolate.RDS"))) {
    url_csv <- "https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2022/2022-01-18/chocolate.csv"
    chocolate <- readr::read_csv(url_csv)

    # save the file to RDS objects
    saveRDS(chocolate, file = here("data", "chocolate.RDS"))
}
```

Making the dataset a tibble and taking a glimpse at the data.

```{r}
chocolate <- readRDS(here("data", "chocolate.RDS"))
as_tibble(chocolate)
glimpse(chocolate)
```

## Part 1: Explore data

1.  Make a histogram of the `rating` scores to visualize the overall distribution of scores. Change the number of bins from the default to 10, 15, 20, and 25. Pick on the one that you think looks the best. Explain what the difference is when you change the number of bins and explain why you picked the one you did.

    ```{r}
    qplot(rating, data = chocolate, bins =10)
    ```

    Number of bins set to 10. The histogram looks worse with more bins as categories with zero observations will start to appear.

2.  Consider the countries where the beans originated from. How many reviews come from each country of bean origin?

    ```{r}
    chocolate  %>%
      count(country_of_bean_origin)
    ```

3.  What is average `rating` scores from reviews of chocolate bars that have Ecuador as `country_of_bean_origin` in this dataset? For this same set of reviews, also calculate (1) the total number of reviews and (2) the standard deviation of the `rating` scores. Your answer should be a new data frame with these three summary statistics in three columns. Label the name of these columns `mean`, `sd`, and `total`.

    ```{r}
        choc.Ecuador <- filter(chocolate, country_of_bean_origin =="Ecuador")
        n_Ecuador <- tibble(country_of_bean_origin="Ecuador", n=1)
        left_join(x=choc.Ecuador, y=n_Ecuador, by="country_of_bean_origin")
        
        summarize(choc.Ecuador,
           mean = mean(rating, na.rm = TRUE),
           sd = sd(rating,  na.rm = TRUE),
           total = sum(n,  na.rm = TRUE)
         )
    ```

4.  Which company (name) makes the best chocolate (or has the highest ratings on average) with beans from Ecuador?

    ```{r}
      choc.Ecuador <- filter(chocolate, country_of_bean_origin =="Ecuador")
      
      best_chocolate <- choc.Ecuador%>%
        group_by(company_manufacturer) %>%
        summarize(
          mean_by_company = mean(rating, na.rm = TRUE)
        )
      
       print(arrange(best_chocolate, desc(mean_by_company)))
    ```

    Amano, Benoit Nihant, Beschle, Durci and Smooth Chocolator tie as the companies with the highest average ratings (4.0).

5.  Calculate the average rating across all country of origins for beans. Which top 3 countries (for bean origin) have the highest ratings on average?

    ```{r}
     best_chocolate_country_origin <- chocolate %>%
        group_by(country_of_bean_origin) %>%
        summarize(
          mean_by_country = mean(rating, na.rm = TRUE)
        )
     
     print(arrange(best_chocolate_country_origin, desc(mean_by_country)))
    ```

    Tobago, China and Sao Tome & Principe are the top 3 countries (for bean origin) that have the highest ratings on average?

6.  Following up on the previous problem, now remove any countries of bean origins that have less than 10 chocolate bar reviews. Now, which top 3 countries have the highest ratings on average?

    ```{r}
        chocolate_n <- chocolate %>%
          mutate(n=1)
      
        chocolate_n2 <- chocolate_n %>%
          group_by(country_of_bean_origin) %>%
          mutate(n_by_origin_country=sum(n, na.rm = TRUE))

        chocolate_n3 <- filter(chocolate_n2, n_by_origin_country>=10)

        best_chocolate_country_origin_n3 <- chocolate_n3 %>%
        group_by(country_of_bean_origin) %>%
        summarize(
          mean_by_country = mean(rating, na.rm = TRUE)
        )
     
     print(arrange(best_chocolate_country_origin_n3, desc(mean_by_country)))
    ```

    Excluding countries of bean origins that have less than 10 chocolate bar reviews, the top 3 countries with the highest ratings on average are Solomon Islands, Congo, and Cuba.

7.  For this last part, let’s explore the relationship between percent chocolate and ratings. Use the functions in `dplyr`, `tidyr`, and `lubridate` to perform the following steps to the `chocolate` dataset:

    1.  Identify the countries of bean origin with at least 50 reviews. Remove reviews from countries are not in this list.

        ```{r}
           chocolate_n <- chocolate %>%
            mutate(n=1)
          
            chocolate_n2 <- chocolate_n %>%
              group_by(country_of_bean_origin) %>%
              mutate(n_by_origin_country=sum(n, na.rm = TRUE))  
            
            chocolate_n4 <- filter(chocolate_n2, n_by_origin_country>=50)
            
            print(chocolate_n4)
        ```

    2.  Using the variable describing the chocolate percentage for each review, create a new column that groups chocolate percentages into one of four groups: (i) \<60%, (ii) \>=60 to \<70%, (iii) \>=70 to \<90%, and (iii) \>=90% (**Hint** check out the `substr()` function in base R and the `case_when()` function from `dplyr` – see example below).

    3.  Using the new column described in #2, re-order the factor levels (if needed) to be starting with the smallest percentage group and increasing to the largest percentage group (**Hint** check out the `fct_relevel()` function from `forcats`).

    4.  For each country, make a set of four side-by-side boxplots plotting the groups on the x-axis and the ratings on the y-axis. These plots should be faceted by country.

        On average, which category of chocolate percentage is most highly rated? Do these countries mostly agree or are there disagreements?

```         
```

## Part 2: **Join two datasets together**

## Part 3: **Convert wide data into long data**

## Part 4: **Data visualization**

## Part 5: **Make the worst plot you can!**

## Part 6: Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
